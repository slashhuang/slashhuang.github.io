{"version":3,"file":"config.js","sources":["../../src/client/config.ts"],"sourcesContent":["import { setupDevtoolsPlugin } from '@vue/devtools-api'\nimport { computed, watch } from 'vue'\nimport type { ClientData } from 'vuepress/client'\nimport { clientDataSymbol, defineClientConfig } from 'vuepress/client'\nimport {\n  resolveThemeLocaleData,\n  themeLocaleDataSymbol,\n  useThemeData,\n} from './composables/index.js'\n\nconst PLUGIN_ID = 'org.vuejs.vuepress.plugin-theme-data'\nconst PLUGIN_LABEL = 'VuePress Theme Data'\nconst PLUGIN_COMPONENT_STATE_TYPE = PLUGIN_LABEL\nconst INSPECTOR_ID = 'org.vuejs.vuepress'\nconst INSPECTOR_LABEL = 'VuePress'\nconst INSPECTOR_CLIENT_DATA_ID = 'client-data'\nconst INSPECTOR_CLIENT_DATA_LABEL = 'Client Data'\n\nexport default defineClientConfig({\n  enhance({ app }) {\n    // provide theme data & theme locale data\n    const themeData = useThemeData()\n    const clientData = app._context.provides[\n      clientDataSymbol as unknown as symbol\n    ] as ClientData\n    const themeLocaleData = computed(() =>\n      resolveThemeLocaleData(themeData.value, clientData.routeLocale.value),\n    )\n    app.provide(themeLocaleDataSymbol, themeLocaleData)\n\n    Object.defineProperties(app.config.globalProperties, {\n      $theme: {\n        get() {\n          return themeData.value\n        },\n      },\n      $themeLocale: {\n        get() {\n          return themeLocaleData.value\n        },\n      },\n    })\n\n    // setup devtools in dev mode\n    if (__VUEPRESS_DEV__ || __VUE_PROD_DEVTOOLS__) {\n      setupDevtoolsPlugin(\n        {\n          // fix recursive reference\n          app: app as never,\n          id: PLUGIN_ID,\n          label: PLUGIN_LABEL,\n          packageName: '@vuepress/plugin-theme-data',\n          homepage: 'https://vuepress.vuejs.org',\n          logo: 'https://vuepress.vuejs.org/images/hero.png',\n          componentStateTypes: [PLUGIN_COMPONENT_STATE_TYPE],\n        },\n        (api) => {\n          api.on.inspectComponent((payload) => {\n            payload.instanceData.state.push(\n              {\n                type: 'VuePress',\n                key: 'themeData',\n                editable: false,\n                value: themeData.value,\n              },\n              {\n                type: 'VuePress',\n                key: 'themeLocaleData',\n                editable: false,\n                value: themeLocaleData.value,\n              },\n            )\n          })\n\n          // setup custom inspector\n          api.addInspector({\n            id: INSPECTOR_ID,\n            label: INSPECTOR_LABEL,\n            icon: 'article',\n          })\n          api.on.getInspectorTree((payload) => {\n            if (payload.inspectorId !== INSPECTOR_ID) return\n\n            payload.rootNodes\n              .find((item) => item.id === INSPECTOR_CLIENT_DATA_ID)\n              ?.children!.push(\n                {\n                  id: 'themeData',\n                  label: 'themeData',\n                },\n                {\n                  id: 'themeLocaleData',\n                  label: 'themeLocaleData',\n                },\n              )\n          })\n\n          api.on.getInspectorState((payload) => {\n            if (payload.inspectorId !== INSPECTOR_ID) return\n\n            if (payload.nodeId === INSPECTOR_CLIENT_DATA_ID) {\n              payload.state[INSPECTOR_CLIENT_DATA_LABEL].push(\n                {\n                  key: 'themeData',\n                  value: themeData.value,\n                },\n                {\n                  key: 'themeLocaleData',\n                  value: themeLocaleData.value,\n                },\n              )\n            }\n\n            if (['themeData', 'themeLocaleData'].includes(payload.nodeId)) {\n              payload.state = {\n                [INSPECTOR_CLIENT_DATA_LABEL]: [\n                  {\n                    key: payload.nodeId,\n                    value:\n                      payload.nodeId === 'themeData'\n                        ? themeData.value\n                        : themeLocaleData.value,\n                  },\n                ],\n              }\n            }\n          })\n\n          // refresh the component state and inspector state\n          watch([themeData, themeLocaleData], () => {\n            api.notifyComponentUpdate()\n            api.sendInspectorState(INSPECTOR_ID)\n          })\n        },\n      )\n    }\n  },\n})\n"],"names":["PLUGIN_ID","PLUGIN_LABEL","PLUGIN_COMPONENT_STATE_TYPE","INSPECTOR_ID","INSPECTOR_LABEL","INSPECTOR_CLIENT_DATA_ID","INSPECTOR_CLIENT_DATA_LABEL","defineClientConfig","app","themeData","useThemeData","clientData","clientDataSymbol","themeLocaleData","computed","resolveThemeLocaleData","themeLocaleDataSymbol","setupDevtoolsPlugin","api","payload","item","watch"],"mappings":"0SAUA,MAAMA,EAAY,uCACZC,EAAe,sBACfC,EAA8BD,EAC9BE,EAAe,qBACfC,EAAkB,WAClBC,EAA2B,cAC3BC,EAA8B,cAEpC,IAAeC,EAAAA,EAAmB,CAChC,QAAQ,CAAE,IAAAC,CAAI,EAAG,CAEf,MAAMC,EAAYC,EAAa,EACzBC,EAAaH,EAAI,SAAS,SAC9BI,CACF,EACMC,EAAkBC,EAAS,IAC/BC,EAAuBN,EAAU,MAAOE,EAAW,YAAY,KAAK,CACtE,EACAH,EAAI,QAAQQ,EAAuBH,CAAe,EAElD,OAAO,iBAAiBL,EAAI,OAAO,iBAAkB,CACnD,OAAQ,CACN,KAAM,CACJ,OAAOC,EAAU,KACnB,CACF,EACA,aAAc,CACZ,KAAM,CACJ,OAAOI,EAAgB,KACzB,CACF,CACF,CAAC,GAGG,kBAAoB,wBACtBI,EACE,CAEE,IAAKT,EACL,GAAIR,EACJ,MAAOC,EACP,YAAa,8BACb,SAAU,6BACV,KAAM,6CACN,oBAAqB,CAACC,CAA2B,CACnD,EACCgB,GAAQ,CACPA,EAAI,GAAG,iBAAkBC,GAAY,CACnCA,EAAQ,aAAa,MAAM,KACzB,CACE,KAAM,WACN,IAAK,YACL,SAAU,GACV,MAAOV,EAAU,KACnB,EACA,CACE,KAAM,WACN,IAAK,kBACL,SAAU,GACV,MAAOI,EAAgB,KACzB,CACF,CACF,CAAC,EAGDK,EAAI,aAAa,CACf,GAAIf,EACJ,MAAOC,EACP,KAAM,SACR,CAAC,EACDc,EAAI,GAAG,iBAAkBC,GAAY,CAC/BA,EAAQ,cAAgBhB,GAE5BgB,EAAQ,UACL,KAAMC,GAASA,EAAK,KAAOf,CAAwB,GAClD,SAAU,KACV,CACE,GAAI,YACJ,MAAO,WACT,EACA,CACE,GAAI,kBACJ,MAAO,iBACT,CACF,CACJ,CAAC,EAEDa,EAAI,GAAG,kBAAmBC,GAAY,CAChCA,EAAQ,cAAgBhB,IAExBgB,EAAQ,SAAWd,GACrBc,EAAQ,MAAMb,CAA2B,EAAE,KACzC,CACE,IAAK,YACL,MAAOG,EAAU,KACnB,EACA,CACE,IAAK,kBACL,MAAOI,EAAgB,KACzB,CACF,EAGE,CAAC,YAAa,iBAAiB,EAAE,SAASM,EAAQ,MAAM,IAC1DA,EAAQ,MAAQ,CACd,CAACb,CAA2B,EAAG,CAC7B,CACE,IAAKa,EAAQ,OACb,MACEA,EAAQ,SAAW,YACfV,EAAU,MACVI,EAAgB,KACxB,CACF,CACF,GAEJ,CAAC,EAGDQ,EAAM,CAACZ,EAAWI,CAAe,EAAG,IAAM,CACxCK,EAAI,wBACJA,EAAI,mBAAmBf,CAAY,CACrC,CAAC,CACH,CACF,CAEJ,CACF,CAAC"}