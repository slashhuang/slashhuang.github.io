{"version":3,"file":"index.js","sources":["../../src/node/preparePaletteFile.ts","../../src/node/prepareStyleFile.ts","../../src/node/presetOptions.ts","../../src/node/palettePlugin.ts"],"sourcesContent":["import type { App } from 'vuepress/core'\nimport { fs } from 'vuepress/utils'\nimport type { PalettePluginOptions } from './palettePlugin.js'\n\nexport const preparePaletteFile = async (\n  app: App,\n  {\n    userPaletteFile,\n    tempPaletteFile,\n    importCode,\n  }: Pick<\n    Required<PalettePluginOptions>,\n    'importCode' | 'tempPaletteFile' | 'userPaletteFile'\n  >,\n): Promise<string> => {\n  const userPalette = app.dir.source(userPaletteFile)\n\n  let content = ''\n\n  if (await fs.pathExists(userPalette)) {\n    content += importCode(userPalette)\n  }\n\n  return app.writeTemp(tempPaletteFile, content)\n}\n","import type { App } from 'vuepress/core'\nimport { fs } from 'vuepress/utils'\nimport type { PalettePluginOptions } from './palettePlugin.js'\n\nexport const prepareStyleFile = async (\n  app: App,\n  {\n    userStyleFile,\n    tempStyleFile,\n    importCode,\n  }: Pick<\n    Required<PalettePluginOptions>,\n    'importCode' | 'tempStyleFile' | 'userStyleFile'\n  >,\n): Promise<string> => {\n  const userStyle = app.dir.source(userStyleFile)\n\n  let content = ''\n\n  if (await fs.pathExists(userStyle)) {\n    content += importCode(userStyle)\n  }\n\n  return app.writeTemp(tempStyleFile, content)\n}\n","import type { PalettePluginOptions } from './palettePlugin.js'\n\n/**\n * Default options for different palette preset\n */\nexport const presetOptions: Record<\n  Required<PalettePluginOptions>['preset'],\n  Omit<Required<PalettePluginOptions>, 'preset'>\n> = {\n  css: {\n    userPaletteFile: '.vuepress/styles/palette.css',\n    tempPaletteFile: 'styles/palette.css',\n    userStyleFile: '.vuepress/styles/index.css',\n    tempStyleFile: 'styles/index.css',\n    importCode: (filePath) => `@import '${filePath}';\\n`,\n  },\n  sass: {\n    userPaletteFile: '.vuepress/styles/palette.scss',\n    tempPaletteFile: 'styles/palette.scss',\n    userStyleFile: '.vuepress/styles/index.scss',\n    tempStyleFile: 'styles/index.scss',\n    importCode: (filePath) => `@forward 'file:///${filePath}';\\n`,\n  },\n  less: {\n    userPaletteFile: '.vuepress/styles/palette.less',\n    tempPaletteFile: 'styles/palette.less',\n    userStyleFile: '.vuepress/styles/index.less',\n    tempStyleFile: 'styles/index.less',\n    importCode: (filePath) => `@import '${filePath}';\\n`,\n  },\n  stylus: {\n    userPaletteFile: '.vuepress/styles/palette.styl',\n    tempPaletteFile: 'styles/palette.styl',\n    userStyleFile: '.vuepress/styles/index.styl',\n    tempStyleFile: 'styles/index.styl',\n    importCode: (filePath) => `@require '${filePath}';\\n`,\n  },\n}\n","import { addViteConfig } from '@vuepress/helper'\nimport { watch } from 'chokidar'\nimport type { Plugin } from 'vuepress/core'\nimport { preparePaletteFile } from './preparePaletteFile.js'\nimport { prepareStyleFile } from './prepareStyleFile.js'\nimport { presetOptions } from './presetOptions.js'\n\n/**\n * Options of @vuepress/plugin-palette\n */\nexport interface PalettePluginOptions {\n  /**\n   * Preset of the palette\n   *\n   * @default 'css'\n   */\n  preset?: 'css' | 'less' | 'sass' | 'stylus'\n\n  /**\n   * File path of the user palette file, relative to source directory\n   */\n  userPaletteFile?: string\n\n  /**\n   * File path of the generated palette temp file, relative to temp directory\n   */\n  tempPaletteFile?: string\n\n  /**\n   * File path of the user style file, relative to source directory\n   */\n  userStyleFile?: string\n\n  /**\n   * File path of the generated style temp file, relative to temp directory\n   */\n  tempStyleFile?: string\n\n  /**\n   * Function to generate import code\n   */\n  importCode?: (filePath: string) => string\n}\n\nexport const palettePlugin = ({\n  preset = 'css',\n  userPaletteFile = presetOptions[preset].userPaletteFile,\n  tempPaletteFile = presetOptions[preset].tempPaletteFile,\n  userStyleFile = presetOptions[preset].userStyleFile,\n  tempStyleFile = presetOptions[preset].tempStyleFile,\n  importCode = presetOptions[preset].importCode,\n}: PalettePluginOptions = {}): Plugin => ({\n  name: '@vuepress/plugin-palette',\n\n  alias: (app) => ({\n    '@vuepress/plugin-palette/palette': app.dir.temp(tempPaletteFile),\n    '@vuepress/plugin-palette/style': app.dir.temp(tempStyleFile),\n  }),\n\n  extendsBundlerOptions: (bundlerOptions: unknown, app): void => {\n    if (preset === 'sass') {\n      // switch to modern api for vite\n      addViteConfig(bundlerOptions, app, {\n        css: {\n          preprocessorOptions: {\n            sass: {\n              api: 'modern',\n            },\n            scss: {\n              api: 'modern',\n            },\n          },\n        },\n      })\n    }\n  },\n\n  onPrepared: async (app) => {\n    await Promise.all([\n      preparePaletteFile(app, {\n        userPaletteFile,\n        tempPaletteFile,\n        importCode,\n      }),\n      prepareStyleFile(app, {\n        userStyleFile,\n        tempStyleFile,\n        importCode,\n      }),\n    ])\n  },\n\n  onWatched: (app, watchers) => {\n    const paletteWatcher = watch(userPaletteFile, {\n      cwd: app.dir.source(),\n      ignoreInitial: true,\n    })\n    paletteWatcher.on('add', () => {\n      void preparePaletteFile(app, {\n        userPaletteFile,\n        tempPaletteFile,\n        importCode,\n      })\n    })\n    paletteWatcher.on('unlink', () => {\n      void preparePaletteFile(app, {\n        userPaletteFile,\n        tempPaletteFile,\n        importCode,\n      })\n    })\n    watchers.push(paletteWatcher)\n\n    const styleWatcher = watch(userStyleFile, {\n      cwd: app.dir.source(),\n      ignoreInitial: true,\n    })\n    styleWatcher.on('add', () => {\n      void prepareStyleFile(app, {\n        userStyleFile,\n        tempStyleFile,\n        importCode,\n      })\n    })\n    styleWatcher.on('unlink', () => {\n      void prepareStyleFile(app, {\n        userStyleFile,\n        tempStyleFile,\n        importCode,\n      })\n    })\n    watchers.push(styleWatcher)\n  },\n})\n"],"names":["preparePaletteFile","app","userPaletteFile","tempPaletteFile","importCode","userPalette","content","fs","prepareStyleFile","userStyleFile","tempStyleFile","userStyle","presetOptions","filePath","palettePlugin","preset","bundlerOptions","addViteConfig","watchers","paletteWatcher","watch","styleWatcher"],"mappings":"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"}