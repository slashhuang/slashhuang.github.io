import{escapeHtml as M}from"@mdit/helper";const x="@tab",y=(n,u)=>(t,r,f,_)=>{if(u.state!==n)return!1;let a=t.bMarks[r]+t.tShift[r],l=t.eMarks[r];if(t.src.charAt(a)!=="@")return!1;let e;for(e=0;e<x.length;e++)if(x[e]!==t.src[a+e])return!1;const s=t.src.slice(a,a+e),o=t.src.slice(a+e,l);if(_)return!0;let i=r,p=!1;for(;i<f&&(i++,a=t.bMarks[i]+t.tShift[i],l=t.eMarks[i],!(a<l&&t.sCount[i]<t.blkIndent));)if(t.src[a]==="@"&&t.sCount[i]<=t.sCount[r]){let m=!0;for(e=0;e<x.length;e++)if(x[e]!==t.src[a+e]){m=!1;break}if(m){p=!0;break}}const k=t.parentType,c=t.lineMax;t.parentType="tab",t.lineMax=i-(p?1:0);const d=t.push(`${n}_tab_open`,"",1),[,$,v]=/^(.*?)(?:(?<!\\)#([^#]*))?$/.exec(o.replace(/^:active/,""));d.block=!0,d.markup=s,d.info=$.trim().replace(/\\#/g,"#"),d.meta={active:o.includes(":active")},v&&(d.meta.id=v.trim()),d.map=[r,i-(p?1:0)],t.md.block.tokenize(t,r+1,i+(p?0:1));const b=t.push(`${n}_tab_close`,"",-1);return b.block=!0,b.markup="",t.parentType=k,t.lineMax=c,t.line=i+(p?0:1),!0},S=(n,u)=>(t,r,f,_)=>{let a=t.bMarks[r]+t.tShift[r],l=t.eMarks[r];if(t.src[a]!==":")return!1;let e=a+1;for(;e<=l&&t.src[e]===":";)e++;const s=e-a;if(s<3)return!1;const o=t.src.slice(a,e),i=t.src.slice(e,l),[p,k=""]=i.split("#",2);if(p.trim()!==n)return!1;if(_)return!0;let c=r,d=!1;for(;c<f&&(c++,a=t.bMarks[c]+t.tShift[c],l=t.eMarks[c],!(a<l&&t.sCount[c]<t.blkIndent));)if(t.src[a]===":"&&t.sCount[c]-t.blkIndent<4){for(e=a+1;e<=l&&t.src[e]===":";e++);if(e-a>=s&&(e=t.skipSpaces(e),e>=l)){d=!0;break}}const $=t.parentType,v=t.lineMax;t.parentType=`${n}_tabs`,t.lineMax=c-(d?1:0);const b=t.push(`${n}_tabs_open`,"",1);b.markup=o,b.block=!0,b.info=p,b.meta={id:k.trim()},b.map=[r,c-(d?1:0)];const m=u.state;u.state=n,t.md.block.tokenize(t,r+1,c-(d?1:0)),u.state=m;const h=t.push(`${n}_tabs_close`,"",-1);return h.markup=t.src.slice(a,e),h.block=!0,t.parentType=$,t.lineMax=v,t.line=c+(d?1:0),!0},C=n=>(u,t)=>{const r=[];let f=-1,_=!1,a=-1;for(let l=t;l<u.length;l++){const{block:e,meta:s,type:o,info:i}=u[l];if(e){if(o===`${n}_tabs_open`){a++;continue}if(o===`${n}_tabs_close`){if(a===0)break;a--;continue}if(a>0)continue;if(o===`${n}_tab_open`){_=!0,s.index=r.length,s.active&&(f===-1?f=r.length:s.active=!1),r.push({title:i,index:s.index,...s.id?{id:s.id}:{}});continue}if(o===`${n}_tab_close`)continue;_||(u[l].type=`${n}_tabs_empty`,u[l].hidden=!0)}}return{active:f,data:r.map((l,e)=>({...l,active:e===f}))}},A=(n,u)=>{const{info:t,meta:r}=n[u];return{title:t,index:r.index,...r.id?{id:r.id}:{},isActive:!!r.active}},g={state:null},T=(n,u)=>{const{name:t="tabs",tabsOpenRenderer:r=(e,s,o,i,p,k)=>{const{active:c,data:d}=e,$=s[o];$.attrJoin("class",`${t}-tabs-wrapper`),$.meta.id&&$.attrJoin("data-id",$.meta.id);const v=d.map(({title:b,id:m},h)=>`<button type="button" class="${t}-tab-button${c===h?" active":""}" data-tab="${h}"${m?` data-id="${M(m)}"`:""}${c===h?" data-active":""}>${M(b)}</button>`);return`<div${k.renderAttrs($)}>
  <div class="${t}-tabs-header">
    ${v.join(`
    `)}
  </div>
  <div class="${t}-tabs-container">
`},tabsCloseRenderer:f=()=>`
  </div>
</div>`,tabOpenRenderer:_=(e,s,o,i,p,k)=>{const c=s[o];return c.attrJoin("class",`${t}-tab-content${e.isActive?" active":""}`),c.attrSet("data-index",e.index.toString()),e.id&&c.attrSet("data-id",e.id.toString()),e.isActive&&c.attrJoin("data-active",""),`<div${k.renderAttrs(s[o])}>`},tabCloseRenderer:a=()=>"</div>"}=u??{},l=C(t);n.block.ruler.before("fence",`${t}_tabs`,S(t,g),{alt:["paragraph","reference","blockquote","list"]}),n.block.ruler.before("paragraph",`${t}_tab`,y(t,g),{alt:["paragraph","reference","blockquote","list"]}),n.renderer.rules[`${t}_tabs_open`]=(e,s,o,i,p)=>{const k=l(e,s);return r(k,e,s,o,i,p)},n.renderer.rules[`${t}_tabs_close`]=f,n.renderer.rules[`${t}_tab_open`]=(e,s,...o)=>{const i=A(e,s);return _(i,e,s,...o)},n.renderer.rules[`${t}_tab_close`]=a};export{T as tab};
//# sourceMappingURL=index.js.map
